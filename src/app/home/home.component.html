<div class="container" [ngClass]="{ 'dark-mode': isDarkMode }">
  <nav class="navbar">
    <div class="logo">Bolt Tech</div>
    <div class="nav-links">
      <a href="#" class="nav-link">หน้าแรก</a>
      <a href="#" class="nav-link">เกี่ยวกับ</a>
      <a href="#" class="nav-link">ผลงาน</a>
      <a href="#" class="nav-link">ติดต่อ</a>
      <button class="theme-toggle" (click)="toggleDarkMode()">
        <span class="material-symbols-outlined">
          {{ isDarkMode ? 'partly_cloudy_day' : 'partly_cloudy_night' }}
        </span>
      </button>
    </div>
  </nav>

  <div class="content">
    <h1>Financial Dashboard</h1>

    <!-- อัปโหลดไฟล์ -->
    <div class="upload-section">
      <label for="file-upload" class="upload-label">
        <span class="material-symbols-outlined">upload_file</span>
        Upload Financial Data
      </label>
      <input 
        type="file" 
        id="file-upload" 
        (change)="onFileSelected($event)" 
        accept=".csv,.xlsx,.xls"
        [disabled]="isLoading"
      >
    </div>

    <!-- แสดง Loading -->
    <div *ngIf="isLoading" class="loading">
      <span class="material-symbols-outlined spinning">sync</span>
      Processing your file...
    </div>

    <!-- เลือกไฟล์และประเภทรายงาน -->
    <div class="controls-section">
      <div class="file-selection">
        <label for="file-select">เลือกไฟล์ข้อมูล:</label>
        <select *ngIf="userFiles.length > 0" [(ngModel)]="selectedFile" class="form-control">
          <option *ngFor="let file of userFiles" [value]="file.file_id">
            {{ file.filename }}
          </option>
        </select>
      </div>

      <div class="report-type-filters">
        <button 
          [class.active]="selectedReportType === 'daily'"
          (click)="setReportType('daily')"
          class="filter-btn">
          Daily
        </button>
        <button 
          [class.active]="selectedReportType === 'monthly'"
          (click)="setReportType('monthly')"
          class="filter-btn">
          Monthly
        </button>
        <button 
          [class.active]="selectedReportType === 'yearly'"
          (click)="setReportType('yearly')"
          class="filter-btn">
          Yearly
        </button>
      </div>

      <button class="btn-load-dashboard" (click)="fetchDashboardSummary()" [disabled]="!selectedFile">
        <span class="material-symbols-outlined">analytics</span>
        โหลดข้อมูล Dashboard
      </button>
    </div>

    <!-- Dashboard Data -->
    <div *ngIf="summary.daily || summary.yearly || summary.monthly_sales" class="dashboard-grid">
      <div *ngIf="summary.daily" class="dashboard-card">
        <h3>Daily Sales</h3>
        <p class="amount">
          ฿{{ summary.daily.sales.toLocaleString() }}
          <span class="growth" [class.positive]="summary.daily.growth > 0">
            {{ summary.daily.growth > 0 ? '+' : '' }}{{ summary.daily.growth }}%
          </span>
        </p>
      </div>

      <div *ngIf="summary.yearly" class="dashboard-card">
        <h3>Yearly Sales</h3>
        <p class="amount">
          ฿{{ summary.yearly.sales.toLocaleString() }}
          <span class="growth" [class.positive]="summary.yearly.growth > 0">
            {{ summary.yearly.growth > 0 ? '+' : '' }}{{ summary.yearly.growth }}%
          </span>
        </p>
      </div>
    </div>

    <!-- Sales Chart -->
    <div *ngIf="summary" class="chart-container">
      <canvas #salesChart></canvas>
    </div>

    <!-- Forecast Chart -->
    <div *ngIf="summary.forecast" class="chart-container">
      <canvas #forecastChart></canvas>
    </div>

    <!-- Top Products -->
    <div *ngIf="summary.top_products" class="top-products">
      <h2>Top Products</h2>
      <div class="products-grid">
        <div *ngFor="let product of summary.top_products" class="product-card">
          <h3>{{ product.product }}</h3>
          <p>Quantity: {{ product.quantity }}</p>
          <p>Revenue: ฿{{ product.revenue.toLocaleString() }}</p>
        </div>
      </div>
    </div>
  </div>
</div>